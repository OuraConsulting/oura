import{d as Ke,u as Xe,r as f,g as Ye,o as Ze,a as y,c as b,f as _e,b as x,j as w,t as N,h as C,n as D,w as we,v as Se,i as Qe,e as Pe,F as et,p as ke,q as Te,s as tt}from"./entry.4c18ed87.js";import{u as A}from"./v4.cfe41f22.js";import{m as Q,R as at,T as j,w as Ie}from"./helpers.46c0e2ed.js";import{_ as rt}from"./MoonLoader.vue_vue_type_script_setup_true_lang.f3d82cc9.js";import{a as nt,u as ot,S as g,E as M}from"./index.32386ac0.js";import{f as st}from"./funnel_event_helper.bd666bbb.js";import{b as q,g as G,d as H,a as it}from"./Attributions.04deae61.js";import{F as Ee}from"./FunnelServices.86ac62aa.js";import{P as O,c as lt,O as ut}from"./orderform_helpers.a48c6ab4.js";import{u as ct}from"./index.4b2713b1.js";import{A as ee,N as te}from"./HLConst.6f34af32.js";import"./components.da3b7a41.js";import"./composables.0b7cf428.js";import"./index.ac4270dc.js";var Oe={exports:{}},ae={};function J(e){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(ae,"__esModule",{value:!0});var Re,Le="https://js.stripe.com/v3",dt=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,xe="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",pt=function(){for(var e=document.querySelectorAll('script[src^="'.concat(Le,'"]')),t=0;t<e.length;t++){var a=e[t];if(dt.test(a.src))return a}return null},vt=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",a=document.createElement("script");a.src="".concat(Le).concat(t);var r=document.head||document.body;if(!r)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return r.appendChild(a),a},mt=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"1.29.0",startTime:t})},z=null,ft=function(e){return null!==z||(z=new Promise((function(t,a){if(typeof window>"u")t(null);else if(window.Stripe&&e&&console.warn(xe),window.Stripe)t(window.Stripe);else try{var r=pt();r&&e?console.warn(xe):r||(r=vt(e)),r.addEventListener("load",(function(){window.Stripe?t(window.Stripe):a(new Error("Stripe.js not available"))})),r.addEventListener("error",(function(){a(new Error("Failed to load Stripe.js"))}))}catch(e){return void a(e)}}))),z},yt=function(e,t,a){if(null===e)return null;var r=e.apply(void 0,t);return mt(r,a),r},gt=function(e){var t="invalid load parameters; expected object of shape\n\n    {advancedFraudSignals: boolean}\n\nbut received\n\n    ".concat(JSON.stringify(e),"\n");if(null===e||"object"!==J(e))throw new Error(t);if(1===Object.keys(e).length&&"boolean"==typeof e.advancedFraudSignals)return e;throw new Error(t)},Ne=!1,Ce=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];Ne=!0;var r=Date.now();return ft(Re).then((function(e){return yt(e,t,r)}))};Ce.setLoadParameters=function(e){if(Ne)throw new Error("You cannot change load parameters after calling loadStripe");Re=gt(e)},ae.loadStripe=Ce,Oe.exports=ae;const ht=ke((()=>Te((()=>import("./NewPaypalSmartBtnSubscription.aa816e10.js")),["./NewPaypalSmartBtnSubscription.aa816e10.js","./paypal-js.67e0b930.js","./index.4b2713b1.js","./entry.4c18ed87.js","./entry.e35d8a05.css","./MoonLoader.vue_vue_type_script_setup_true_lang.f3d82cc9.js","./NewPaypalSmartBtnSubscription.3a186e73.css"],import.meta.url).then((e=>e.default||e)))),bt=ke((()=>Te((()=>import("./NewPaypalSmartBtnOrder.e84e7088.js")),["./NewPaypalSmartBtnOrder.e84e7088.js","./paypal-js.67e0b930.js","./index.4b2713b1.js","./entry.4c18ed87.js","./entry.e35d8a05.css","./MoonLoader.vue_vue_type_script_setup_true_lang.f3d82cc9.js","./NewPaypalSmartBtnOrder.3a186e73.css"],import.meta.url).then((e=>e.default||e)))),_t=["href","target"],wt={key:0,style:{"margin-right":"5px"},class:"button-icon-start"},St={class:"main-heading-button"},Pt={key:1,style:{"margin-left":"5px"},class:"button-icon-end"},It={class:"sub-heading-button"},Et=["disabled","id"],xt={key:0,class:"button-icon-start"},kt={class:"main-heading-button"},Tt={key:1,class:"button-icon-end"},Ot={class:"sub-heading-button"},Lt={class:"btn-loader-position",style:{left:"50%",position:"absolute",top:"50%",transform:"translate(-50%, -50%)"}},Rt={key:2,style:{width:"70%",margin:"auto"},class:"paypal-content"},Nt={key:3,class:"card-el-error-msg error-message",style:{"justify-content":"center"}},Ct={inheritAttrs:!1},Jt=Ke({...Ct,__name:"Button",props:{element:{type:Object,required:!0},classStyles:{type:Array,required:!0}},setup(e){var t,a,r,n,o,l,s;const i=e,u=ct(),{openPopup:c}=nt(),{call:d,createMembershipToken:p,mailTo:v,sms:m,goToNextFunnelStep:h,openUrl:_,getNextFunnelStepURL:I}=ot(),P=Xe(),{$bus:S}=P;let k=null==(a=null==(t=i.element.extra)?void 0:t.text)?void 0:a.value;k=Q(k);let E=null==(n=null==(r=i.element.extra)?void 0:r.subText)?void 0:n.value;E=Q(E);const T=u.value.funnelId,L=u.value.stepId,R=u.value.funnelPageId,$=u.value.locationId,F=null==(s=null==(l=null==(o=i.element.extra)?void 0:o.productId)?void 0:l.value)?void 0:s.id,U=f("avascript: void(0)"),B=f(!1),J=f(!1),W=f(""),K=f(""),z=f(),V=f(!1),X=f(""),Y=f(""),Z=f(""),ae=f(!1),re=Ye((()=>{var e;return"recurring"===(null==(e=z.value)?void 0:e.price.type)})),ne=f(),oe=f("");async function le(){u.value.videoExistsInPage&&S.$emit("handle-redirect")}async function se(){const{action:e}=i.element.extra;switch(e.value){case"openPopup":c();break;case"url":{const{visitWebsite:e}=i.element.extra;_(e.value);break}case"hide-element":{const{hideElements:e}=i.element.extra;at(e.value);break}case"scroll-to-element":{const{scrollToElement:e}=i.element.extra;S.$emit("scroll-to-element",e.value);break}case"go-to-next-funnel-step":B.value=!0,h();break;case g.GO_TO_STEP:B.value=!0,h(i.element.extra.stepPath.value);break;case"sell-product":if(B.value=!0,2===u.value.orderFormVersion)if("pp"===A("provider").value)V.value=!0;else{if(u.value.defaultPaymentProvider===ee&&u.value.merchantLoginId)return void ce(ee);if(u.value.defaultPaymentProvider===te&&u.value.nmiMerchantGatewayId)return void ce(te);const e=u.value.stripePublishableKey,t=u.value.stripeAccountId;if(!e||!t)return void alert("Stripe account not found!");X.value=await Oe.exports.loadStripe(e,{stripeAccount:t}),async function(){var e;try{if(!F)throw new Error("No product Id found for initiating stripe payment");if(oe.value="",await ue(),!ne.value||(null==(e=ne.value)?void 0:e.error))return;const t={altId:$,altType:"location",orderId:ne.value.order._id},a=await O.initiateStripePayment(t);if(!a.success)return void(oe.value=a.message||"We're sorry, but something went wrong. Please try again.");const{clientSecret:r,paymentMethodId:n}=a;if(r){const e=await X.value.confirmCardPayment(r,{payment_method:n,setup_future_usage:"off_session"});if(e.error)return console.error("Failed to confirm card payment!",e.error),void(e.error.message&&alert(e.error.message))}const{orderId:o,paymentIntentId:l,subscriptionId:s,invoiceId:i,subId:u,txnId:c}=a,d={altId:$,altType:"location",orderId:o,paymentIntentId:l,subscriptionId:s,invoiceId:i,isAuth:!1,subId:u,txnId:c,attribution:{eventData:q(),sessionId:G($),sessionFingerprint:H($)}},p=await O.verifyStripePayment(d);if(console.log("verifyPaymentResponseData",p),!p.success)return void(oe.value=p.message||"We're sorry, but something went wrong. Please try again.");await ie(p)}catch(e){oe.value=j(e),B.value=!1,console.error(e)}}()}else!async function(){if(F)try{const e=it(),t={...q(),fbEventId:e},a=G($),r=H($),n=await Ee.funnelPayment({fingerprint:A("msgsndr_id").value,productList:[F],locationId:$,funnelId:T,stepId:L,pageId:R,domain:u.value.domain,pageUrl:u.value.pageUrl,source:"payment_button",submissionType:3,eventData:t,sessionId:a,sessionFingerprint:r,_mp:A("_mp").value});await ie(n)}catch(e){console.log(e)}finally{B.value=!0}}();break;case"click-to-call":{const e=i.element.extra;d(e[M.PHONE_NUMBER].value);break}case"click-to-sms":{const e=i.element.extra;m(e[M.PHONE_NUMBER].value);break}case"click-to-mail":{const e=i.element.extra;v(e[M.EMAIL_ADDRESS].value);break}case g.GO_TO_MEMBERSHIP:try{let e;const t=u.value.locationId,{ct:a,previewUrl:r}=JSON.parse(decodeURIComponent(A(`_mf_${t}`).value));e="localhost"===location.hostname?`http://localhost:4040/library/?domain=${r}&token=${a}&location_id=${t}`:`${r}/library?&token=${a}&location_id=${t}`,_({url:e,newTab:!1})}catch{alert("Sorry something went wrong.")}break;default:console.error(`Invalid action type received: ${e.value}`)}}function ie(e){var t,a;try{const r=null==e?void 0:e.membershipPurchase;null!=r&&r.length&&p($,r[0].token);const n=null==e?void 0:e.membershipToken;n&&p($,n),tt((()=>{st("track","Upsell")}));const{saleAction:o,stepPath:l,visitWebsite:s}=i.element.extra;if(!o){if(u.value.funnelNextStep)return void h();throw new Error("Redirect not handled")}if(2===u.value.orderFormVersion){const e=`_pl_${u.value.funnelId}`,t=localStorage.getItem(e);if(t){let a=JSON.parse(t);a.push(z.value),Ie(e,JSON.stringify(a))}}else{const e=`_pl_v1_${u.value.funnelId}`,r=localStorage.getItem(e);if(r){let n=JSON.parse(r);n.push(null==(a=null==(t=null==i?void 0:i.element.extra)?void 0:t.productId)?void 0:a.value),Ie(e,JSON.stringify(n))}}switch(o.value){case"url":if(s&&s.value&&s.value.url){_(s.value);break}throw new Error("Redirect not handled");case"step-path":if(l&&l.value){h(l.value);break}throw new Error("Redirect not handled");default:if(u.value.funnelNextStep){h();break}throw new Error("Redirect not handled")}}catch{return alert("Order successfully placed! \n However, Something went wrong while displaying this webpage, please contact the seller."),void(B.value=!1)}}Ze((()=>{const{action:{value:e}}=i.element.extra;if(e===g.GO_TO_NEXT_STEP||e===g.SELL_PRODUCT){const e=u.value.funnelDomain,t=u.value.funnelNextPageId;e?U.value=`https://${e}${u.value.funnelNextStep}`:t&&(U.value=`https://${window.location.host}/v2/preview/${t}`)}(e===g.CLICK_TO_CALL||e===g.CLICK_TO_SMS||e===g.GO_TO_URL||e===g.GO_TO_STEP)&&(J.value=!0,W.value=function(){let e="";const{action:{value:t}}=i.element.extra;switch(t){case g.CLICK_TO_CALL:{let t=i.element.extra[M.PHONE_NUMBER].value;t=t.replace("tel:",""),e=`tel:${t}`;break}case g.CLICK_TO_SMS:{let t=i.element.extra[M.PHONE_NUMBER].value;t=t.replace("sms:",""),e=`sms:${t}`;break}case g.GO_TO_URL:{const{visitWebsite:{value:t}}=i.element.extra,{url:a,newTab:r}=t;e=a,e=Q(e),e&&!e.startsWith("#")&&!/^https?:/.test(e)&&(e=`https://${e}`),K.value=r?"_blank":"";break}case g.GO_TO_STEP:{const t=i.element.extra.stepPath.value;e=I(t);break}}return e}()),2===u.value.orderFormVersion&&F&&e===g.SELL_PRODUCT&&async function(){var e,t,a;try{const t=await Ee.findProductById({productId:F});z.value={...t,qty:1,amount:t.price.amount},Y.value=null==(e=null==t?void 0:t.price)?void 0:e.currency}catch(e){const r=(null==(a=null==(t=null==e?void 0:e.response)?void 0:t.data)?void 0:a.message)||(null==e?void 0:e.message)||"Not able to fetch products!";alert(r)}}()}));const ue=async()=>{var e;let t=localStorage.getItem("_ud");t&&(t=JSON.parse(t));const a=null==t?void 0:t.customer_id;a?(ne.value=await lt({contactId:a,domain:u.value.domain,pageUrl:u.value.pageUrl,locationId:$,productPreviewList:[{_id:F,qty:1}],store:u.value,subType:ut.UPSELL,traceId:null==t?void 0:t.traceId}),null!=(e=ne.value)&&e.error&&(ae.value=!1)):oe.value="Contact not found!"};async function ce(e){var t,a,r;try{if(!F)throw new Error("No product Id found for initiating stripe payment");if(ae.value=!0,oe.value="",await ue(),!ne.value||(null==(t=ne.value)?void 0:t.error))return;let n;if(null!=(a=ne.value)&&a.order._id){let t;switch(n={altId:$,altType:"location",orderId:null==(r=ne.value)?void 0:r.order._id,attribution:{eventData:q(),sessionId:G($),sessionFingerprint:H($)}},e){case ee:t=await O.authorizeNetOrderPayment(n);break;case te:t=await O.nmiOrderPayment(n);break;default:console.log("Invalid payment provider")}if(console.log(t),ae.value=!1,!t.success)return void(oe.value=t.message||"We're sorry, but something went wrong. Please try again.");await ie({membershipPurchase:t.membershipPurchase,membershipToken:t.membershipToken})}}catch(e){B.value=!1,ae.value=!1,console.log(e),oe.value=j(e)}}async function de(e,t){var a,r;try{if(!F)throw new Error("No product Id found for initiating paypal payment");if(ae.value=!0,Z.value="",oe.value="",await ue(),!ne.value||(null==(a=ne.value)?void 0:a.error))return;const e={altId:$,altType:"location",orderId:null==(r=ne.value)?void 0:r.order._id},n=await O.initiatePayPalPayment(e);if(!n.success)return void(oe.value=n.message||"We're sorry, but something went wrong. Please try again.");if(t.subscription&&n.plan_id)return t.subscription.create(n);if(t.order&&n.id)return n.id}catch(e){console.log(e.message),Z.value=j(e),ae.value=!1}}async function pe(e){try{if(!F)throw new Error("No product Id found for paypal payment");ae.value=!0,Z.value="",oe.value="";const t={facilitatorAccessToken:e.facilitatorAccessToken,orderId:ne.value.order._id,paypalOrderId:e.orderID,altId:$,altType:"location",attribution:{eventData:q(),sessionId:G($),sessionFingerprint:H($)}};e.payerID&&(t.paypalPayerId=e.payerID),e.subscriptionID&&(t.paypalSubscriptionId=e.subscriptionID);const a=await O.verifyPayPalPayment(t);if(console.log("verifyPaymentResponseData",a),!a.success)return void(oe.value=a.message||"We're sorry, but something went wrong. Please try again.");A("provider").value="pp",await ie(a)}catch(e){console.error(e.message),Z.value=j(e),ae.value=!1}}function ve(){ae.value=!1,Z.value="Transaction has been cancelled by the user!"}return(t,a)=>{const r=ht,n=bt;return y(),b(et,null,[J.value?(y(),b("a",{key:0,href:W.value,target:K.value,class:_e(e.classStyles),onClick:le},[x("span",{style:D(B.value?"visibility: hidden;":""),class:"main-heading-group"},[""!==e.element.extra.icon?(y(),b("span",wt)):w("",!0),x("span",St,N(C(k)),1),""!==e.element.extra.icon?(y(),b("span",Pt)):w("",!0)],4),e.element.extra.subText&&e.element.extra.subText.value?(y(),b("span",{key:0,style:D(B.value?"visibility: hidden;":""),class:"sub-heading-group text-xs font-sans"},[x("span",It,N(C(E)),1)],4)):w("",!0)],10,_t)):we((y(),b("button",{key:1,disabled:B.value,id:e.element.id,style:D(B.value?"cursor: default;":""),class:_e([e.classStyles]),onClick:se},[x("div",{style:D(B.value?"visibility: hidden;":""),class:"main-heading-group"},[""!==e.element.extra.icon?(y(),b("div",xt)):w("",!0),x("div",kt,N(C(k)),1),""!==e.element.extra.icon?(y(),b("div",Tt)):w("",!0)],4),e.element.extra.subText&&e.element.extra.subText.value?(y(),b("div",{key:0,style:D(B.value?"visibility: hidden;":""),class:"text-xs font-sans"},[x("div",Ot,N(C(E)),1)],4)):w("",!0),we(x("div",Lt,[Qe(rt,{loading:B.value,color:"rgb(255, 255, 255)",size:"30px"},null,8,["loading"])],512),[[Se,B.value]])],14,Et)),[[Se,!V.value]]),V.value&&Y.value?(y(),b("div",Rt,[C(re)?(y(),Pe(r,{key:0,initiatePaypalPayment:de,onApprovePaypalPayment:pe,onCancelPaypalPayment:ve,paypalErrorMsg:Z.value,processingPayment:ae.value,currency:Y.value},null,8,["paypalErrorMsg","processingPayment","currency"])):(y(),Pe(n,{key:1,initiatePaypalPayment:de,onApprovePaypalPayment:pe,onCancelPaypalPayment:ve,paypalErrorMsg:Z.value,processingPayment:ae.value,currency:Y.value},null,8,["paypalErrorMsg","processingPayment","currency"]))])):w("",!0),oe.value?(y(),b("div",Nt,N(oe.value),1)):w("",!0)],64)}}});export{Jt as default};